unit WvN.DelphiShader.FX.ImageAudrey;

interface

uses GR32, Types, WvN.DelphiShader.Shader;

type
  TImageAudrey = class(TShader)
  var
    c,d:array[1..199] of vec2;

  const
    v : array[1..199] of vec4=(
     (x: 1.000; y: 0.371; z: 0.379; w: 11.770),
     (x: 0.992; y: 0.545; z: 0.551; w: 8.3590),
     (x: 0.749; y: 0.623; z: 0.990; w: 36.571),
     (x: 1.000; y: 0.510; z: 0.395; w: 11.315),
     (x: 1.000; y: 0.723; z: 0.564; w: 15.170),
     (x: 0.953; y: 0.729; z: 0.750; w: 14.629),
     (x: 0.706; y: 0.982; z: 0.033; w: 16.254),
     (x: 1.000; y: 0.855; z: 0.652; w: 26.256),
     (x: 1.000; y: 0.664; z: 0.623; w: 81.920),
     (x: 0.000; y: 0.881; z: 0.750; w: 8.0310),
     (x: 0.686; y: 0.682; z: 0.900; w: 27.676),
     (x: 1.000; y: 0.189; z: 0.684; w: 18.618),
     (x: 0.000; y: 0.904; z: 0.750; w: 8.0310),
     (x: 1.000; y: 0.422; z: 0.195; w: 44.522),
     (x: 1.000; y: 0.779; z: 0.750; w: 16.787),
     (x: 1.000; y: 0.645; z: 0.330; w: 14.222),
     (x: 1.000; y: 0.197; z: 0.648; w: 22.505),
     (x: 0.702; y: 0.512; z: 0.393; w: 35.310),
     (x: 1.000; y: 0.744; z: 0.621; w: 14.949),
     (x: 0.671; y: 0.885; z: 0.092; w: 24.675),
     (x: 0.000; y: 0.344; z: 0.750; w: 8.0310),
     (x: 1.000; y: 0.760; z: 0.465; w: 40.960),
     (x: 0.008; y: 0.908; z: 0.311; w: 8.0310),
     (x: 0.016; y: 0.959; z: 0.750; w: 10.039),
     (x: 0.004; y: 0.930; z: 0.750; w: 12.800),
     (x: 1.000; y: 0.555; z: 0.250; w: 19.883),
     (x: 1.000; y: 0.770; z: 1.018; w: 15.876),
     (x: 0.000; y: 0.828; z: 0.756; w: 36.571),
     (x: 0.580; y: 0.566; z: 0.424; w: 89.043),
     (x: 0.988; y: 0.162; z: 0.691; w: 40.157),
     (x: 0.000; y: 0.314; z: 0.750; w: 8.0310),
     (x: 0.000; y: 0.947; z: 0.125; w: 32.000),
     (x: 0.914; y: 0.844; z: 0.725; w: 52.513),
     (x: 1.000; y: 0.313; z: 0.762; w: 42.667),
     (x: 0.996; y: 0.676; z: 0.689; w: 85.333),
     (x: 0.980; y: 0.346; z: 0.559; w: 24.675),
     (x: 1.000; y: 0.553; z: 0.250; w: 18.789),
     (x: 0.004; y: 0.258; z: 0.248; w: 8.0310),
     (x: 1.000; y: 0.420; z: 0.742; w: 30.567),
     (x: 0.906; y: 0.543; z: 0.250; w: 22.756),
     (x: 0.863; y: 0.674; z: 0.322; w: 20.078),
     (x: 0.753; y: 0.357; z: 0.686; w: 78.769),
     (x: 0.906; y: 0.795; z: 0.705; w: 37.236),
     (x: 0.933; y: 0.520; z: 0.365; w: 38.642),
     (x: 0.996; y: 0.318; z: 0.488; w: 14.734),
     (x: 0.337; y: 0.486; z: 0.281; w: 81.920),
     (x: 0.965; y: 0.691; z: 0.516; w: 16.650),
     (x: 0.808; y: 0.582; z: 0.973; w: 52.513),
     (x: 0.012; y: 0.240; z: 0.928; w: 8.0630),
     (x: 1.000; y: 0.496; z: 0.217; w: 31.508),
     (x: 0.000; y: 0.658; z: 0.953; w: 34.133),
     (x: 0.871; y: 0.582; z: 0.172; w: 62.061),
     (x: 0.855; y: 0.346; z: 0.342; w: 17.504),
     (x: 0.878; y: 0.787; z: 0.648; w: 28.845),
     (x: 0.000; y: 0.984; z: 0.111; w: 35.310),
     (x: 0.855; y: 0.514; z: 0.965; w: 66.065),
     (x: 0.561; y: 0.613; z: 0.350; w: 81.920),
     (x: 0.992; y: 0.818; z: 0.902; w: 21.558),
     (x: 0.914; y: 0.746; z: 0.615; w: 40.157),
     (x: 0.557; y: 0.580; z: 0.125; w: 60.235),
     (x: 0.475; y: 0.547; z: 0.414; w: 70.621),
     (x: 0.843; y: 0.680; z: 0.793; w: 20.277),
     (x: 1.000; y: 0.230; z: 0.758; w: 56.889),
     (x: 1.000; y: 0.299; z: 0.691; w: 68.267),
     (x: 0.737; y: 0.518; z: 0.100; w: 68.267),
     (x: 0.996; y: 0.227; z: 0.514; w: 41.796),
     (x: 0.929; y: 0.850; z: 0.770; w: 62.061),
     (x: 0.682; y: 0.834; z: 0.111; w: 30.118),
     (x: 0.996; y: 0.854; z: 0.793; w: 58.514),
     (x: 0.490; y: 0.736; z: 0.889; w: 19.321),
     (x: 0.980; y: 0.465; z: 0.725; w: 16.126),
     (x: 0.992; y: 0.484; z: 1.010; w: 23.273),
     (x: 0.008; y: 0.949; z: 0.727; w: 23.540),
     (x: 0.012; y: 0.086; z: 0.086; w: 8.0310),
     (x: 1.000; y: 0.121; z: 0.750; w: 44.522),
     (x: 0.427; y: 0.617; z: 0.891; w: 27.676),
     (x: 0.804; y: 0.693; z: 0.633; w: 78.769),
     (x: 0.012; y: 0.711; z: 0.084; w: 13.745),
     (x: 0.082; y: 0.584; z: 0.338; w:107.789),
     (x: 0.929; y: 0.613; z: 0.268; w: 19.692),
     (x: 0.200; y: 0.549; z: 0.420; w:128.000),
     (x: 1.000; y: 0.402; z: 0.717; w: 26.947),
     (x: 0.000; y: 0.551; z: 0.168; w: 45.511),
     (x: 0.992; y: 0.627; z: 0.621; w: 56.889),
     (x: 0.902; y: 0.361; z: 0.748; w: 40.960),
     (x: 0.984; y: 0.344; z: 0.754; w: 38.642),
     (x: 0.902; y: 0.203; z: 0.818; w: 51.200),
     (x: 1.000; y: 0.230; z: 0.803; w: 52.513),
     (x: 0.922; y: 0.738; z: 0.691; w: 47.628),
     (x: 0.000; y: 0.385; z: 0.797; w: 43.574),
     (x: 0.000; y: 0.725; z: 0.305; w: 62.061),
     (x: 0.000; y: 0.150; z: 0.750; w: 45.511),
     (x: 1.000; y: 0.742; z: 0.408; w: 47.628),
     (x: 0.000; y: 0.645; z: 0.643; w: 60.235),
     (x: 1.000; y: 0.645; z: 0.438; w: 35.310),
     (x: 0.510; y: 0.564; z: 0.789; w: 18.450),
     (x: 0.863; y: 0.211; z: 0.781; w: 30.567),
     (x: 0.106; y: 0.508; z: 0.328; w: 89.043),
     (x: 0.012; y: 0.410; z: 0.875; w: 14.629),
     (x: 1.000; y: 0.871; z: 0.877; w: 48.762),
     (x: 1.000; y: 0.258; z: 0.779; w: 37.926),
     (x: 0.000; y: 0.436; z: 0.807; w: 28.845),
     (x: 0.918; y: 0.861; z: 0.836; w: 49.951),
     (x: 1.000; y: 0.291; z: 0.770; w: 40.960),
     (x: 0.000; y: 0.750; z: 0.283; w: 27.676),
     (x: 0.965; y: 0.596; z: 0.572; w: 28.055),
     (x: 0.902; y: 0.803; z: 0.953; w: 24.976),
     (x: 0.957; y: 0.498; z: 0.600; w: 16.126),
     (x: 0.914; y: 0.322; z: 0.432; w: 15.634),
     (x: 0.008; y: 0.025; z: 0.621; w: 17.809),
     (x: 0.000; y: 0.916; z: 0.713; w: 56.889),
     (x: 0.914; y: 0.547; z: 0.971; w: 47.628),
     (x: 0.000; y: 0.207; z: 0.432; w: 37.926),
     (x: 0.875; y: 0.176; z: 0.793; w: 46.545),
     (x: 0.000; y: 0.646; z: 0.668; w: 41.796),
     (x: 1.000; y: 0.721; z: 0.691; w: 51.200),
     (x: 0.451; y: 0.559; z: 0.754; w: 49.951),
     (x: 0.969; y: 0.846; z: 0.750; w: 58.514),
     (x: 0.000; y: 0.900; z: 0.146; w: 36.571),
     (x: 1.000; y: 0.613; z: 0.635; w: 85.333),
     (x: 0.596; y: 0.807; z: 0.150; w: 58.514),
     (x: 0.898; y: 0.330; z: 0.760; w: 40.157),
     (x: 0.694; y: 0.594; z: 0.012; w: 51.200),
     (x: 0.698; y: 0.592; z: 0.055; w: 53.895),
     (x: 0.902; y: 0.268; z: 0.773; w: 39.385),
     (x: 0.925; y: 0.838; z: 0.660; w: 58.514),
     (x: 0.843; y: 0.670; z: 0.242; w: 28.444),
     (x: 0.243; y: 0.465; z: 0.285; w: 85.333),
     (x: 0.816; y: 0.588; z: 0.674; w: 44.522),
     (x: 0.008; y: 0.283; z: 0.115; w: 8.0310),
     (x: 0.247; y: 0.414; z: 0.691; w: 60.235),
     (x: 1.000; y: 0.104; z: 0.781; w: 60.235),
     (x: 0.000; y: 0.619; z: 0.660; w: 60.235),
     (x: 0.584; y: 0.650; z: 0.994; w: 46.545),
     (x: 0.000; y: 0.219; z: 0.393; w: 36.571),
     (x: 1.000; y: 0.307; z: 0.645; w: 97.524),
     (x: 0.953; y: 0.639; z: 0.771; w: 38.642),
     (x: 0.000; y: 0.238; z: 0.357; w: 34.712),
     (x: 0.922; y: 0.713; z: 0.352; w: 53.895),
     (x: 0.965; y: 0.387; z: 0.748; w: 43.574),
     (x: 0.000; y: 0.898; z: 0.633; w: 41.796),
     (x: 0.941; y: 0.352; z: 0.488; w: 14.734),
     (x: 0.933; y: 0.439; z: 0.725; w: 30.567),
     (x: 0.310; y: 0.541; z: 0.906; w: 47.628),
     (x: 0.941; y: 0.502; z: 0.689; w: 24.094),
     (x: 0.094; y: 0.527; z: 0.330; w: 85.333),
     (x: 0.000; y: 0.090; z: 0.688; w: 55.351),
     (x: 0.000; y: 0.652; z: 0.713; w: 75.852),
     (x: 0.949; y: 0.320; z: 0.623; w:107.789),
     (x: 0.890; y: 0.775; z: 0.750; w: 22.505),
     (x: 0.012; y: 0.918; z: 0.490; w: 14.322),
     (x: 1.000; y: 0.871; z: 0.967; w: 58.514),
     (x: 0.000; y: 0.324; z: 0.676; w: 64.000),
     (x: 0.008; y: 0.141; z: 0.248; w: 8.0310),
     (x: 0.000; y: 0.633; z: 0.707; w: 75.852),
     (x: 0.910; y: 0.385; z: 0.207; w: 44.522),
     (x: 0.012; y: 0.703; z: 0.182; w: 31.508),
     (x: 0.000; y: 0.617; z: 0.703; w: 73.143),
     (x: 0.890; y: 0.352; z: 0.225; w: 45.511),
     (x: 0.933; y: 0.826; z: 0.604; w: 44.522),
     (x: 0.914; y: 0.777; z: 0.574; w: 25.924),
     (x: 0.631; y: 0.781; z: 0.182; w: 68.267),
     (x: 1.000; y: 0.873; z: 0.916; w: 48.762),
     (x: 0.694; y: 0.520; z: 0.113; w: 81.920),
     (x: 0.000; y: 0.900; z: 0.926; w: 58.514),
     (x: 0.184; y: 0.598; z: 0.344; w:146.286),
     (x: 0.863; y: 0.678; z: 0.250; w: 35.310),
     (x: 0.090; y: 0.566; z: 0.332; w: 78.769),
     (x: 0.420; y: 0.445; z: 0.301; w: 56.889),
     (x: 0.973; y: 0.617; z: 0.516; w: 18.124),
     (x: 0.000; y: 0.191; z: 0.500; w: 39.385),
     (x: 0.000; y: 0.240; z: 0.326; w: 31.508),
     (x: 0.000; y: 0.264; z: 0.322; w: 55.351),
     (x: 0.000; y: 0.604; z: 0.699; w: 70.621),
     (x: 0.000; y: 0.113; z: 0.604; w: 43.574),
     (x: 0.894; y: 0.760; z: 0.697; w: 49.951),
     (x: 0.914; y: 0.725; z: 0.383; w: 55.351),
     (x: 0.000; y: 0.199; z: 0.467; w: 48.762),
     (x: 0.000; y: 0.904; z: 0.660; w: 52.513),
     (x: 0.922; y: 0.611; z: 0.191; w: 45.511),
     (x: 0.059; y: 0.789; z: 0.869; w: 30.118),
     (x: 0.976; y: 0.641; z: 0.213; w: 40.960),
     (x: 0.918; y: 0.402; z: 0.742; w: 47.628),
     (x: 0.945; y: 0.717; z: 0.582; w: 40.157),
     (x: 0.000; y: 0.299; z: 0.672; w: 58.514),
     (x: 0.000; y: 0.719; z: 0.666; w: 48.762),
     (x: 0.882; y: 0.697; z: 0.271; w: 58.514),
     (x: 0.929; y: 0.752; z: 0.436; w: 64.000),
     (x: 1.000; y: 0.867; z: 0.813; w: 56.889),
     (x: 0.643; y: 0.588; z: 0.090; w: 64.000),
     (x: 0.012; y: 0.063; z: 0.922; w: 10.952),
     (x: 0.878; y: 0.186; z: 0.750; w: 31.508),
     (x: 0.953; y: 0.648; z: 0.613; w:120.471),
     (x: 0.973; y: 0.180; z: 0.576; w: 45.511),
     (x: 0.741; y: 0.943; z: 0.076; w: 52.513),
     (x: 0.059; y: 0.545; z: 0.332; w: 89.043),
     (x: 0.094; y: 0.295; z: 0.734; w: 85.333),
     (x: 0.008; y: 0.676; z: 0.721; w: 85.333),
     (x: 0.550; y: 0.350; z: 0.650; w: 85.000));

    constructor Create; override;
    procedure PrepareFrame;
    function mainImage(var fragCoord: vec2): TColor32;
  end;

var
  ImageAudrey: TShader;

implementation

uses SysUtils, Math;

constructor TImageAudrey.Create;
var
  I: Integer;
begin
  inherited;
  FrameProc := PrepareFrame;
  PixelProc := mainImage;

  for I := 1 to 199 do
    d[I] := v[I].yz;

end;

procedure TImageAudrey.PrepareFrame;
var i:integer;
    an:float;
begin
  an     := smoothstep(0, 1, cos(iGlobalTime));
  for I := 1 to 199 do
    c[I] := (an * cosLarge(iGlobalTime + 100 * v[I].yz));
end;


function TImageAudrey.mainImage(var fragCoord: vec2): TColor32;
var
  uv : vec2;
  col: float;
  I  : Integer;
  dd : vec2;
  b  : ^vec4;
  ps : vec2;
begin
  uv    := fragCoord.xy / resolution.y;
  uv.x  := uv.x - (0.5 * (resolution.x / resolution.y - 1));
  col   := 0;
  for I := 1 to 199 do
  begin
    ps  := uv + c[I];
    dd  := ps - d[I];
    b   := @v[I];
    col := mix(col, b.x, exp(-b.w * b.w * dot(dd, dd)));
    if abs(b.z - 0.5) < 0.251 then
    begin
      dd.x := ps.x - 1 + b.y;
      col  := mix(col, b.x, exp(-b.w * b.w * dot(dd, dd)));
    end;
  end;
  Result := TColor32(Vec3(col));
end;

initialization

ImageAudrey := TImageAudrey.Create;
Shaders.Add('ImageAudrey', ImageAudrey);

finalization

FreeandNil(ImageAudrey);

end.
